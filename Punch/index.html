<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
	<title>–ö—Ä–æ–ª–∏–∫ –ü–∞–Ω—á</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
	
	<!-- Made with Construct, the game and app creator :: https://www.construct.net -->
	<meta name="generator" content="Scirra Construct">
	
	<!-- –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–ª—è VK Bridge -->
	<meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://unpkg.com https://vk.com https://*.vk.com https://*.vkontakte.ru; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com https://vk.com https://*.vk.com; connect-src 'self' https://vk.com https://*.vk.com https://*.vkontakte.ru wss://*.vk.com;">
	<meta name="referrer" content="no-referrer-when-downgrade">

	<link rel="manifest" href="appmanifest.json">
	<link rel="apple-touch-icon" sizes="128x128" href="icons/icon-128.png">
	<link rel="apple-touch-icon" sizes="256x256" href="icons/icon-256.png">
	<link rel="icon" type="image/png" href="icons/icon-256.png">

	<link rel="stylesheet" href="style.css">

	<!-- VK Multiplayer Styles -->
	<style>
		/* VK –ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä UI —Å—Ç–∏–ª–∏ */
		.vk-multiplayer-ui {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.8);
			display: none;
			justify-content: center;
			align-items: center;
			z-index: 10000;
			font-family: Arial, sans-serif;
		}

		.vk-multiplayer-modal {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			border-radius: 15px;
			padding: 30px;
			text-align: center;
			color: white;
			box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
			max-width: 400px;
			width: 90%;
		}

		.vk-multiplayer-title {
			font-size: 24px;
			font-weight: bold;
			margin-bottom: 20px;
		}

		.vk-multiplayer-status {
			font-size: 16px;
			margin-bottom: 20px;
			opacity: 0.9;
		}

		.vk-multiplayer-spinner {
			width: 40px;
			height: 40px;
			border: 4px solid rgba(255, 255, 255, 0.3);
			border-top: 4px solid white;
			border-radius: 50%;
			animation: spin 1s linear infinite;
			margin: 0 auto 20px;
		}

		@keyframes spin {
			0% { transform: rotate(0deg); }
			100% { transform: rotate(360deg); }
		}

		.vk-multiplayer-button {
			background: rgba(255, 255, 255, 0.2);
			border: 2px solid rgba(255, 255, 255, 0.3);
			color: white;
			padding: 12px 24px;
			border-radius: 8px;
			font-size: 16px;
			cursor: pointer;
			transition: all 0.3s ease;
			margin: 5px;
		}

		.vk-multiplayer-button:hover {
			background: rgba(255, 255, 255, 0.3);
			border-color: rgba(255, 255, 255, 0.5);
		}

		.vk-game-info {
			position: fixed;
			top: 10px;
			right: 10px;
			background: rgba(0, 0, 0, 0.7);
			color: white;
			padding: 10px;
			border-radius: 8px;
			font-family: Arial, sans-serif;
			font-size: 12px;
			z-index: 1000;
			display: none;
		}

		.vk-game-info.active {
			display: block;
		}

		.vk-player-info {
			margin-bottom: 5px;
		}

		.vk-score {
			font-weight: bold;
			color: #4CAF50;
		}

		.vk-opponent-score {
			font-weight: bold;
			color: #FF5722;
		}

		/* –ö–Ω–æ–ø–∫–∞ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞ –≤ –∏–≥—Ä–µ */
		.vk-multiplayer-menu-button {
			position: fixed;
			bottom: 20px;
			right: 20px;
			width: 60px;
			height: 60px;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			border: none;
			border-radius: 50%;
			color: white;
			font-size: 24px;
			cursor: pointer;
			box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
			transition: all 0.3s ease;
			z-index: 1000;
			display: flex;
			align-items: center;
			justify-content: center;
			font-family: Arial, sans-serif;
		}

		.vk-multiplayer-menu-button:hover {
			transform: scale(1.1);
			box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
		}

		.vk-multiplayer-menu-button:active {
			transform: scale(0.95);
		}

		.vk-multiplayer-menu-button.hidden {
			display: none;
		}

		/* –ü—É–ª—å—Å–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ */
		@keyframes pulse {
			0% { box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); }
			50% { box-shadow: 0 6px 25px rgba(102, 126, 234, 0.8); }
			100% { box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); }
		}

		.vk-multiplayer-menu-button.pulse {
			animation: pulse 2s infinite;
		}
	</style>
</head> 
 
<body>
	<script>
if (location.protocol.substr(0, 4) === "file")
{
	alert("Web exports won't work until you upload them. (When running on the file: protocol, browsers block many features from working for security reasons.)");
}
	</script>
	
	<noscript>
		<div id="notSupportedWrap">
			<h2 id="notSupportedTitle">This content requires JavaScript</h2>
			<p class="notSupportedMessage">JavaScript appears to be disabled. Please enable it to view this content.</p>
		</div>
	</noscript>
	<script src="scripts/modernjscheck.js"></script>
	<script src="scripts/supportcheck.js"></script>
	
	<!-- VK Bridge –¥–ª—è –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞ -->
	<script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
	<script src="scripts/vk-multiplayer-minimal.js"></script>
	
	<!-- VK Multiplayer UI -->
	<div id="vkMultiplayerUI" class="vk-multiplayer-ui">
		<div class="vk-multiplayer-modal">
			<div class="vk-multiplayer-title">üéÆ –ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä</div>
			<div class="vk-multiplayer-spinner"></div>
			<div id="vkMultiplayerStatus" class="vk-multiplayer-status">–ü–æ–∏—Å–∫ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...</div>
			<button id="vkCancelButton" class="vk-multiplayer-button">–û—Ç–º–µ–Ω–∏—Ç—å</button>
		</div>
	</div>

	<!-- Game Info Panel -->
	<div id="vkGameInfo" class="vk-game-info">
		<div class="vk-player-info">–í—ã: <span id="vkMyScore" class="vk-score">0</span></div>
		<div class="vk-player-info">–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫: <span id="vkOpponentScore" class="vk-opponent-score">0</span></div>
		<div class="vk-player-info">–°—Ç–∞—Ç—É—Å: <span id="vkGameStatus">–í –∏–≥—Ä–µ</span></div>
	</div>

	<!-- –ö–Ω–æ–ø–∫–∞ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞ -->
	<button id="vkMultiplayerMenuButton" class="vk-multiplayer-menu-button pulse" title="–ò–≥—Ä–∞—Ç—å —Å —Å–ª—É—á–∞–π–Ω—ã–º –∏–≥—Ä–æ–∫–æ–º">
		üéÆ
	</button>

	<script>
		// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Construct 3
		window.StartMultiplayerMatchmaking = function() {
			console.log('üéÆ –ó–∞–ø—É—Å–∫ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä –º–∞—Ç—á–º–µ–π–∫–∏–Ω–≥–∞');
			if (window.vkMultiplayerMinimal) {
				return window.vkMultiplayerMinimal.startMatchmaking();
			}
			return false;
		};

		window.SendMultiplayerMove = function(moveType, x, y, score, combo) {
			console.log('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ö–æ–¥–∞:', { moveType, x, y, score, combo });
			if (window.vkMultiplayer) {
				window.vkMultiplayer.sendMove(moveType, x, y, score, combo);
			}
		};

		window.EndMultiplayerGame = function() {
			console.log('üèÅ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä –∏–≥—Ä—ã');
			if (window.vkMultiplayer) {
				window.vkMultiplayer.endGame();
			}
		};

		window.CancelMultiplayerMatchmaking = function() {
			console.log('‚ùå –û—Ç–º–µ–Ω–∞ –ø–æ–∏—Å–∫–∞ –∏–≥—Ä—ã');
			if (window.vkMultiplayerMinimal) {
				window.vkMultiplayerMinimal.cancelMatchmaking();
			}
		};

		window.GetMultiplayerState = function() {
			if (window.vkMultiplayerMinimal) {
				return window.vkMultiplayerMinimal.getState();
			}
			return { isActive: false };
		};

		window.IsMultiplayerActive = function() {
			const state = window.GetMultiplayerState();
			return state.isActive;
		};

		// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞
		window.OnShowMatchmakingUI = function() {
			const ui = document.getElementById('vkMultiplayerUI');
			const status = document.getElementById('vkMultiplayerStatus');
			const button = document.getElementById('vkCancelButton');
			
			if (ui) {
				ui.style.display = 'flex';
				status.textContent = '–ü–æ–∏—Å–∫ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...';
				button.style.display = 'block';
			}
			
			// –°–∫—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞ –≤–æ –≤—Ä–µ–º—è –ø–æ–∏—Å–∫–∞
			window.HideMultiplayerButton();
		};

		// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞
		window.addEventListener('DOMContentLoaded', function() {
			const multiplayerButton = document.getElementById('vkMultiplayerMenuButton');
			const cancelButton = document.getElementById('vkCancelButton');
			
			// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞
			if (multiplayerButton) {
				multiplayerButton.addEventListener('click', function() {
					console.log('üéÆ –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞');
					window.StartMultiplayerMatchmaking();
				});
			}
			
			// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –æ—Ç–º–µ–Ω—ã
			if (cancelButton) {
				cancelButton.addEventListener('click', function() {
					console.log('‚ùå –û—Ç–º–µ–Ω–∞ –ø–æ–∏—Å–∫–∞ –∏–≥—Ä—ã');
					window.CancelMultiplayerMatchmaking();
				});
			}
		});

		window.OnHideMatchmakingUI = function() {
			const ui = document.getElementById('vkMultiplayerUI');
			if (ui) {
				ui.style.display = 'none';
			}
			
			// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞ –ø–æ—Å–ª–µ —Å–∫—Ä—ã—Ç–∏—è –ø–æ–∏—Å–∫–∞
			window.ShowMultiplayerButton();
		};

		window.OnMultiplayerGameStart = function(opponentId, gameId) {
			console.log('üéÆ –ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å!', { opponentId, gameId });
			
			// –°–∫—Ä—ã–≤–∞–µ–º UI –ø–æ–∏—Å–∫–∞
			window.OnHideMatchmakingUI();
			
			// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
			const gameInfo = document.getElementById('vkGameInfo');
			if (gameInfo) {
				gameInfo.classList.add('active');
			}
			
			// –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
			const status = document.getElementById('vkGameStatus');
			if (status) {
				status.textContent = '–í –∏–≥—Ä–µ';
			}
			
			// –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞ –≤–æ –≤—Ä–µ–º—è –∏–≥—Ä—ã
			window.HideMultiplayerButton();
		};

		window.OnOpponentMove = function(moveType, x, y, score, combo) {
			console.log('üëä –•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞:', { moveType, x, y, score, combo });
			
			// –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
			const opponentScore = document.getElementById('vkOpponentScore');
			if (opponentScore) {
				opponentScore.textContent = score;
			}
		};

		window.OnMultiplayerGameEnd = function(result, myScore, opponentScore) {
			console.log('üèÅ –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞:', { result, myScore, opponentScore });
			
			// –°–∫—Ä—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
			const gameInfo = document.getElementById('vkGameInfo');
			if (gameInfo) {
				gameInfo.classList.remove('active');
			}
			
			// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
			let resultText = '';
			if (result === 'win') resultText = 'üèÜ –ü–æ–±–µ–¥–∞!';
			else if (result === 'lose') resultText = 'üòî –ü–æ—Ä–∞–∂–µ–Ω–∏–µ';
			else resultText = 'ü§ù –ù–∏—á—å—è';
			
			const ui = document.getElementById('vkMultiplayerUI');
			const status = document.getElementById('vkMultiplayerStatus');
			const button = document.getElementById('vkCancelButton');
			
			if (ui && status && button) {
				ui.style.display = 'flex';
				status.innerHTML = `${resultText}<br/>–í–∞—à —Å—á–µ—Ç: ${myScore}<br/>–°—á–µ—Ç –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞: ${opponentScore}`;
				button.textContent = '–ó–∞–∫—Ä—ã—Ç—å';
				button.onclick = function() {
					ui.style.display = 'none';
					// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
					window.ShowMultiplayerButton();
				};
			}
		};

		// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞ –∏–≥—Ä–æ–∫–∞
		window.UpdateMyMultiplayerScore = function(score) {
			const myScore = document.getElementById('vkMyScore');
			if (myScore) {
				myScore.textContent = score;
			}
		};

		// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç—å—é –∫–Ω–æ–ø–∫–∏ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞
		window.ShowMultiplayerButton = function() {
			const button = document.getElementById('vkMultiplayerMenuButton');
			if (button) {
				button.classList.remove('hidden');
				button.classList.add('pulse');
			}
		};

		window.HideMultiplayerButton = function() {
			const button = document.getElementById('vkMultiplayerMenuButton');
			if (button) {
				button.classList.add('hidden');
				button.classList.remove('pulse');
			}
		};

		// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–æ–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
		window.UpdateMultiplayerButtonState = function() {
			const state = window.GetMultiplayerState();
			const button = document.getElementById('vkMultiplayerMenuButton');
			
			if (button) {
				if (state.isActive) {
					// –í–æ –≤—Ä–µ–º—è –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞ —Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
					button.classList.add('hidden');
					button.classList.remove('pulse');
				} else {
					// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∫–æ–≥–¥–∞ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω
					button.classList.remove('hidden');
					button.classList.add('pulse');
				}
			}
		};

		// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è UI
		document.addEventListener('DOMContentLoaded', function() {
			const cancelButton = document.getElementById('vkCancelButton');
			if (cancelButton) {
				cancelButton.onclick = function() {
					window.CancelMultiplayerMatchmaking();
				};
			}
			
			// –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
			setInterval(function() {
				window.UpdateMultiplayerButtonState();
			}, 1000);
		});
	</script>
	
	<script src="scripts/offlineclient.js" type="module"></script>
	<script src="scripts/main.js" type="module"></script>
	<script src="scripts/register-sw.js" type="module"></script>

</body> 
</html>