<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
	<title>–ö—Ä–æ–ª–∏–∫ –ü–∞–Ω—á</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
	
	<!-- Made with Construct, the game and app creator :: https://www.construct.net -->
	<meta name="generator" content="Scirra Construct">

	<link rel="manifest" href="appmanifest.json">
	<link rel="apple-touch-icon" sizes="128x128" href="icons/icon-128.png">
	<link rel="apple-touch-icon" sizes="256x256" href="icons/icon-256.png">
	<link rel="icon" type="image/png" href="icons/icon-256.png">

	<link rel="stylesheet" href="style.css">

	<!-- VK Multiplayer Styles -->
	<style>
		/* VK –ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä UI —Å—Ç–∏–ª–∏ */
		.vk-multiplayer-ui {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.8);
			display: none;
			justify-content: center;
			align-items: center;
			z-index: 10000;
			font-family: Arial, sans-serif;
		}

		.vk-multiplayer-modal {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			border-radius: 15px;
			padding: 30px;
			text-align: center;
			color: white;
			box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
			max-width: 400px;
			width: 90%;
		}

		.vk-multiplayer-title {
			font-size: 24px;
			font-weight: bold;
			margin-bottom: 20px;
		}

		.vk-multiplayer-status {
			font-size: 16px;
			margin-bottom: 20px;
			opacity: 0.9;
		}

		.vk-multiplayer-spinner {
			width: 40px;
			height: 40px;
			border: 4px solid rgba(255, 255, 255, 0.3);
			border-top: 4px solid white;
			border-radius: 50%;
			animation: spin 1s linear infinite;
			margin: 0 auto 20px;
		}

		@keyframes spin {
			0% { transform: rotate(0deg); }
			100% { transform: rotate(360deg); }
		}

		.vk-multiplayer-button {
			background: rgba(255, 255, 255, 0.2);
			border: 2px solid rgba(255, 255, 255, 0.3);
			color: white;
			padding: 12px 24px;
			border-radius: 8px;
			font-size: 16px;
			cursor: pointer;
			transition: all 0.3s ease;
			margin: 5px;
		}

		.vk-multiplayer-button:hover {
			background: rgba(255, 255, 255, 0.3);
			border-color: rgba(255, 255, 255, 0.5);
		}

		.vk-game-info {
			position: fixed;
			top: 10px;
			right: 10px;
			background: rgba(0, 0, 0, 0.7);
			color: white;
			padding: 10px;
			border-radius: 8px;
			font-family: Arial, sans-serif;
			font-size: 12px;
			z-index: 1000;
			display: none;
		}

		.vk-game-info.active {
			display: block;
		}

		.vk-player-info {
			margin-bottom: 5px;
		}

		.vk-score {
			font-weight: bold;
			color: #4CAF50;
		}

		.vk-opponent-score {
			font-weight: bold;
			color: #FF5722;
		}
	</style>
</head> 
 
<body>
	<script>
if (location.protocol.substr(0, 4) === "file")
{
	alert("Web exports won't work until you upload them. (When running on the file: protocol, browsers block many features from working for security reasons.)");
}
	</script>
	
	<noscript>
		<div id="notSupportedWrap">
			<h2 id="notSupportedTitle">This content requires JavaScript</h2>
			<p class="notSupportedMessage">JavaScript appears to be disabled. Please enable it to view this content.</p>
		</div>
	</noscript>
	<script src="scripts/modernjscheck.js"></script>
	<script src="scripts/supportcheck.js"></script>
	
	<!-- VK Bridge –¥–ª—è –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞ -->
	<script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
	<script src="scripts/vk-multiplayer.js"></script>
	
	<!-- VK Multiplayer UI -->
	<div id="vkMultiplayerUI" class="vk-multiplayer-ui">
		<div class="vk-multiplayer-modal">
			<div class="vk-multiplayer-title">üéÆ –ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä</div>
			<div class="vk-multiplayer-spinner"></div>
			<div id="vkMultiplayerStatus" class="vk-multiplayer-status">–ü–æ–∏—Å–∫ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...</div>
			<button id="vkCancelButton" class="vk-multiplayer-button">–û—Ç–º–µ–Ω–∏—Ç—å</button>
		</div>
	</div>

	<!-- Game Info Panel -->
	<div id="vkGameInfo" class="vk-game-info">
		<div class="vk-player-info">–í—ã: <span id="vkMyScore" class="vk-score">0</span></div>
		<div class="vk-player-info">–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫: <span id="vkOpponentScore" class="vk-opponent-score">0</span></div>
		<div class="vk-player-info">–°—Ç–∞—Ç—É—Å: <span id="vkGameStatus">–í –∏–≥—Ä–µ</span></div>
	</div>

	<script>
		// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Construct 3
		window.StartMultiplayerMatchmaking = function() {
			console.log('üéÆ –ó–∞–ø—É—Å–∫ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä –º–∞—Ç—á–º–µ–π–∫–∏–Ω–≥–∞');
			if (window.vkMultiplayer) {
				return window.vkMultiplayer.startMatchmaking();
			}
			return false;
		};

		window.SendMultiplayerMove = function(moveType, x, y, score, combo) {
			console.log('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ö–æ–¥–∞:', { moveType, x, y, score, combo });
			if (window.vkMultiplayer) {
				window.vkMultiplayer.sendMove(moveType, x, y, score, combo);
			}
		};

		window.EndMultiplayerGame = function() {
			console.log('üèÅ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä –∏–≥—Ä—ã');
			if (window.vkMultiplayer) {
				window.vkMultiplayer.endGame();
			}
		};

		window.CancelMultiplayerMatchmaking = function() {
			console.log('‚ùå –û—Ç–º–µ–Ω–∞ –ø–æ–∏—Å–∫–∞ –∏–≥—Ä—ã');
			if (window.vkMultiplayer) {
				window.vkMultiplayer.cancelMatchmaking();
			}
		};

		window.GetMultiplayerState = function() {
			if (window.vkMultiplayer) {
				return window.vkMultiplayer.getMultiplayerState();
			}
			return { isActive: false };
		};

		window.IsMultiplayerActive = function() {
			const state = window.GetMultiplayerState();
			return state.isActive;
		};

		// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞
		window.OnShowMatchmakingUI = function() {
			const ui = document.getElementById('vkMultiplayerUI');
			const status = document.getElementById('vkMultiplayerStatus');
			const button = document.getElementById('vkCancelButton');
			
			if (ui) {
				ui.style.display = 'flex';
				status.textContent = '–ü–æ–∏—Å–∫ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...';
				button.style.display = 'block';
			}
		};

		window.OnHideMatchmakingUI = function() {
			const ui = document.getElementById('vkMultiplayerUI');
			if (ui) {
				ui.style.display = 'none';
			}
		};

		window.OnMultiplayerGameStart = function(opponentId, gameId) {
			console.log('üéÆ –ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å!', { opponentId, gameId });
			
			// –°–∫—Ä—ã–≤–∞–µ–º UI –ø–æ–∏—Å–∫–∞
			window.OnHideMatchmakingUI();
			
			// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
			const gameInfo = document.getElementById('vkGameInfo');
			if (gameInfo) {
				gameInfo.classList.add('active');
			}
			
			// –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
			const status = document.getElementById('vkGameStatus');
			if (status) {
				status.textContent = '–í –∏–≥—Ä–µ';
			}
		};

		window.OnOpponentMove = function(moveType, x, y, score, combo) {
			console.log('üëä –•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞:', { moveType, x, y, score, combo });
			
			// –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
			const opponentScore = document.getElementById('vkOpponentScore');
			if (opponentScore) {
				opponentScore.textContent = score;
			}
		};

		window.OnMultiplayerGameEnd = function(result, myScore, opponentScore) {
			console.log('üèÅ –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞:', { result, myScore, opponentScore });
			
			// –°–∫—Ä—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
			const gameInfo = document.getElementById('vkGameInfo');
			if (gameInfo) {
				gameInfo.classList.remove('active');
			}
			
			// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
			let resultText = '';
			if (result === 'win') resultText = 'üèÜ –ü–æ–±–µ–¥–∞!';
			else if (result === 'lose') resultText = 'üòî –ü–æ—Ä–∞–∂–µ–Ω–∏–µ';
			else resultText = 'ü§ù –ù–∏—á—å—è';
			
			const ui = document.getElementById('vkMultiplayerUI');
			const status = document.getElementById('vkMultiplayerStatus');
			const button = document.getElementById('vkCancelButton');
			
			if (ui && status && button) {
				ui.style.display = 'flex';
				status.innerHTML = `${resultText}<br/>–í–∞—à —Å—á–µ—Ç: ${myScore}<br/>–°—á–µ—Ç –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞: ${opponentScore}`;
				button.textContent = '–ó–∞–∫—Ä—ã—Ç—å';
				button.onclick = function() {
					ui.style.display = 'none';
				};
			}
		};

		// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞ –∏–≥—Ä–æ–∫–∞
		window.UpdateMyMultiplayerScore = function(score) {
			const myScore = document.getElementById('vkMyScore');
			if (myScore) {
				myScore.textContent = score;
			}
		};

		// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è UI
		document.addEventListener('DOMContentLoaded', function() {
			const cancelButton = document.getElementById('vkCancelButton');
			if (cancelButton) {
				cancelButton.onclick = function() {
					window.CancelMultiplayerMatchmaking();
				};
			}
		});
	</script>
	
	<script src="scripts/offlineclient.js" type="module"></script>
	<script src="scripts/main.js" type="module"></script>
	<script src="scripts/register-sw.js" type="module"></script>

</body> 
</html>