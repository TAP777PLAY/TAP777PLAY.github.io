<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üê∞ VK –ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä - –ö—Ä–æ–ª–∏–∫ –ü–∞–Ω—á</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .demo-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #667eea;
        }

        .demo-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .status {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .status.info { background: #d1ecf1; color: #0c5460; }
        .status.success { background: #d4edda; color: #155724; }
        .status.warning { background: #fff3cd; color: #856404; }
        .status.error { background: #f8d7da; color: #721c24; }

        .game-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .player-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .player-card h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .score {
            font-size: 2em;
            font-weight: bold;
            color: #28a745;
            margin: 10px 0;
        }

        .log {
            background: #2d3748;
            color: #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .log-entry.info { color: #63b3ed; }
        .log-entry.success { color: #68d391; }
        .log-entry.warning { color: #fbd38d; }
        .log-entry.error { color: #fc8181; }

        .vk-info {
            background: linear-gradient(45deg, #4680c2, #5a9fd4);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .commands {
            background: #f1f5f9;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .commands h4 {
            color: #475569;
            margin-bottom: 10px;
        }

        .command-btn {
            background: #64748b;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            font-size: 12px;
            margin: 2px;
            cursor: pointer;
        }

        .command-btn:hover {
            background: #475569;
        }

        @media (max-width: 768px) {
            .game-info {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üê∞ VK –ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä "–ö—Ä–æ–ª–∏–∫ –ü–∞–Ω—á"</h1>
        
        <div class="vk-info">
            <strong>üîó VK Bridge Demo</strong><br>
            –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞ —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É –í–ö–æ–Ω—Ç–∞–∫—Ç–µ
        </div>
        
        <div class="demo-section">
            <h3>–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</h3>
            <div id="systemStatus" class="status info">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è VK Bridge...</div>
            <div id="playerInfo" class="status info">–û–∂–∏–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–∞...</div>
        </div>

        <div class="demo-section">
            <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–æ–º</h3>
            <div class="controls">
                <button id="startMatchmaking">üéÆ –ù–∞–π—Ç–∏ –∏–≥—Ä—É</button>
                <button id="cancelMatchmaking" disabled>‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫</button>
                <button id="sendMove" disabled>üëä –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ö–æ–¥</button>
                <button id="endGame" disabled>üèÅ –ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É</button>
                <button id="resetDemo">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –¥–µ–º–æ</button>
            </div>
        </div>

        <div class="demo-section">
            <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–≥—Ä–µ</h3>
            <div class="game-info">
                <div class="player-card">
                    <h4>–í—ã</h4>
                    <div class="score" id="myScore">0</div>
                    <div id="myName">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    <div id="myStats">–†–µ–π—Ç–∏–Ω–≥: 1000</div>
                </div>
                <div class="player-card">
                    <h4>–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫</h4>
                    <div class="score" id="opponentScore">0</div>
                    <div id="opponentName">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
                    <div id="gameStatus">–ù–µ –≤ –∏–≥—Ä–µ</div>
                </div>
            </div>
        </div>

        <div class="demo-section">
            <h3>–õ–æ–≥–∏ —Å–æ–±—ã—Ç–∏–π</h3>
            <div id="eventLog" class="log"></div>
            <div class="commands">
                <h4>–ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</h4>
                <button class="command-btn" onclick="testVKBridge()">–¢–µ—Å—Ç VK Bridge</button>
                <button class="command-btn" onclick="testStorage()">–¢–µ—Å—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–∞</button>
                <button class="command-btn" onclick="simulateMove()">–°–∏–º—É–ª—è—Ü–∏—è —Ö–æ–¥–∞</button>
                <button class="command-btn" onclick="clearLogs()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
            </div>
        </div>
    </div>

    <!-- VK Bridge (–∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è) -->
    <script>
        // –≠–º—É–ª—è—Ü–∏—è VK Bridge –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        if (typeof vkBridge === 'undefined') {
            window.vkBridge = {
                send: async function(method, params = {}) {
                    console.log(`VK Bridge: ${method}`, params);
                    
                    // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏
                    await new Promise(resolve => setTimeout(resolve, 200));
                    
                    switch (method) {
                        case 'VKWebAppInit':
                            return { result: true };
                        
                        case 'VKWebAppGetUserInfo':
                            return {
                                id: 123456789,
                                first_name: '–¢–µ—Å—Ç–æ–≤—ã–π',
                                last_name: '–ò–≥—Ä–æ–∫',
                                photo_100: 'https://via.placeholder.com/100'
                            };
                        
                        case 'VKWebAppStorageGet':
                            const key = params.keys[0];
                            const mockData = {
                                'multiplayer_games': '[]',
                                'player_stats': JSON.stringify({
                                    gamesPlayed: 5,
                                    wins: 3,
                                    losses: 2,
                                    rating: 1150
                                })
                            };
                            return {
                                keys: [{
                                    key: key,
                                    value: mockData[key] || ''
                                }]
                            };
                        
                        case 'VKWebAppStorageSet':
                            return { result: true };
                        
                        case 'VKWebAppShowWallPostBox':
                            return { result: true };
                        
                        case 'VKWebAppGetFriends':
                            return {
                                users: [
                                    { id: 987654321, first_name: '–î—Ä—É–≥', last_name: '–¢–µ—Å—Ç–æ–≤—ã–π' }
                                ]
                            };
                        
                        default:
                            return { result: true };
                    }
                }
            };
        }
    </script>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞ -->
    <script src="scripts/vk-multiplayer.js"></script>

    <!-- –î–µ–º–æ-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
    <script>
        class VKMultiplayerDemo {
            constructor() {
                this.eventLog = [];
                this.myScore = 0;
                this.opponentScore = 0;
                this.gameActive = false;
                
                this.initializeDemo();
                this.setupEventListeners();
            }

            initializeDemo() {
                this.log('üöÄ –ó–∞–ø—É—Å–∫ VK –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä –¥–µ–º–æ...', 'info');
                
                // –ñ–¥–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞
                const checkMultiplayer = () => {
                    if (window.vkMultiplayer && window.vkMultiplayer.isVKReady) {
                        this.updateSystemStatus('VK Bridge –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ', 'success');
                        this.updatePlayerInfo();
                        this.log('‚úÖ VK –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä –≥–æ—Ç–æ–≤', 'success');
                    } else {
                        setTimeout(checkMultiplayer, 500);
                    }
                };
                
                checkMultiplayer();
            }

            setupEventListeners() {
                // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                document.getElementById('startMatchmaking').addEventListener('click', () => {
                    this.startMatchmaking();
                });

                document.getElementById('cancelMatchmaking').addEventListener('click', () => {
                    this.cancelMatchmaking();
                });

                document.getElementById('sendMove').addEventListener('click', () => {
                    this.sendTestMove();
                });

                document.getElementById('endGame').addEventListener('click', () => {
                    this.endGame();
                });

                document.getElementById('resetDemo').addEventListener('click', () => {
                    this.resetDemo();
                });

                // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞
                window.OnShowMatchmakingUI = () => {
                    this.log('üîç –ü–æ–∫–∞–∑ UI –ø–æ–∏—Å–∫–∞ –∏–≥—Ä—ã', 'info');
                    this.updateGameStatus('–ü–æ–∏—Å–∫ –∏–≥—Ä—ã...');
                    this.toggleButtons(false, true, false, false);
                };

                window.OnHideMatchmakingUI = () => {
                    this.log('‚ùå –°–∫—Ä—ã—Ç–∏–µ UI –ø–æ–∏—Å–∫–∞ –∏–≥—Ä—ã', 'info');
                };

                window.OnMultiplayerGameStart = (opponentId, gameId) => {
                    this.log(`üéÆ –ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å! –ü—Ä–æ—Ç–∏–≤–Ω–∏–∫: ${opponentId}, –ò–≥—Ä–∞: ${gameId}`, 'success');
                    this.updateGameStatus('–í –∏–≥—Ä–µ');
                    this.updateOpponentInfo('–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –Ω–∞–π–¥–µ–Ω');
                    this.toggleButtons(false, false, true, true);
                    this.gameActive = true;
                };

                window.OnOpponentMove = (moveType, x, y, score, combo) => {
                    this.log(`üëä –•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞: ${moveType} (${x}, ${y}) - ${score} –æ—á–∫–æ–≤`, 'info');
                    this.opponentScore = score;
                    this.updateOpponentScore();
                };

                window.OnMultiplayerGameEnd = (result, myScore, opponentScore) => {
                    this.log(`üèÅ –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: ${result} (${myScore} : ${opponentScore})`, 'success');
                    this.updateGameStatus(`–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: ${result}`);
                    this.toggleButtons(true, false, false, false);
                    this.gameActive = false;
                };
            }

            async startMatchmaking() {
                this.log('üîç –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–∏—Å–∫ –∏–≥—Ä—ã...', 'info');
                
                if (window.StartMultiplayerMatchmaking) {
                    const result = await window.StartMultiplayerMatchmaking();
                    if (result) {
                        this.log('‚úÖ –ü–æ–∏—Å–∫ –∏–≥—Ä—ã –∑–∞–ø—É—â–µ–Ω', 'success');
                    } else {
                        this.log('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –ø–æ–∏—Å–∫–∞', 'error');
                    }
                } else {
                    this.log('‚ùå –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞', 'error');
                }
            }

            cancelMatchmaking() {
                this.log('‚ùå –û—Ç–º–µ–Ω–∞ –ø–æ–∏—Å–∫–∞ –∏–≥—Ä—ã...', 'warning');
                
                if (window.CancelMultiplayerMatchmaking) {
                    window.CancelMultiplayerMatchmaking();
                    this.updateGameStatus('–ü–æ–∏—Å–∫ –æ—Ç–º–µ–Ω–µ–Ω');
                    this.toggleButtons(true, false, false, false);
                }
            }

            sendTestMove() {
                if (!this.gameActive) return;
                
                this.myScore += Math.floor(Math.random() * 50) + 10;
                const moveType = Math.random() > 0.5 ? 'punch' : 'combo';
                const x = Math.floor(Math.random() * 100);
                const y = Math.floor(Math.random() * 100);
                const combo = Math.floor(Math.random() * 5) + 1;
                
                this.log(`üëä –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ö–æ–¥: ${moveType} (${x}, ${y}) - ${this.myScore} –æ—á–∫–æ–≤`, 'info');
                
                if (window.SendMultiplayerMove) {
                    window.SendMultiplayerMove(moveType, x, y, this.myScore, combo);
                    this.updateMyScore();
                }
            }

            endGame() {
                this.log('üèÅ –ó–∞–≤–µ—Ä—à–∞–µ–º –∏–≥—Ä—É...', 'warning');
                
                if (window.EndMultiplayerGame) {
                    window.EndMultiplayerGame();
                }
            }

            resetDemo() {
                this.log('üîÑ –°–±—Ä–æ—Å –¥–µ–º–æ...', 'info');
                
                this.myScore = 0;
                this.opponentScore = 0;
                this.gameActive = false;
                
                this.updateMyScore();
                this.updateOpponentScore();
                this.updateGameStatus('–ù–µ –≤ –∏–≥—Ä–µ');
                this.updateOpponentInfo('–û–∂–∏–¥–∞–Ω–∏–µ...');
                this.toggleButtons(true, false, false, false);
                
                // –û—á–∏—â–∞–µ–º —á–∞—Å—Ç—å –ª–æ–≥–æ–≤
                this.eventLog = this.eventLog.slice(-10);
                this.updateLogDisplay();
            }

            updateSystemStatus(message, type) {
                const statusEl = document.getElementById('systemStatus');
                statusEl.textContent = message;
                statusEl.className = `status ${type}`;
            }

            updatePlayerInfo() {
                if (window.vkMultiplayer) {
                    const playerName = window.vkMultiplayer.playerName || '–¢–µ—Å—Ç–æ–≤—ã–π –∏–≥—Ä–æ–∫';
                    const playerId = window.vkMultiplayer.playerId || '123456789';
                    const stats = window.vkMultiplayer.playerStats || { rating: 1000 };
                    
                    document.getElementById('myName').textContent = playerName;
                    document.getElementById('myStats').textContent = `–†–µ–π—Ç–∏–Ω–≥: ${stats.rating}`;
                    document.getElementById('playerInfo').textContent = `–ò–≥—Ä–æ–∫: ${playerName} (ID: ${playerId})`;
                    document.getElementById('playerInfo').className = 'status success';
                }
            }

            updateGameStatus(status) {
                document.getElementById('gameStatus').textContent = status;
            }

            updateOpponentInfo(info) {
                document.getElementById('opponentName').textContent = info;
            }

            updateMyScore() {
                document.getElementById('myScore').textContent = this.myScore;
            }

            updateOpponentScore() {
                document.getElementById('opponentScore').textContent = this.opponentScore;
            }

            toggleButtons(start, cancel, move, end) {
                document.getElementById('startMatchmaking').disabled = !start;
                document.getElementById('cancelMatchmaking').disabled = !cancel;
                document.getElementById('sendMove').disabled = !move;
                document.getElementById('endGame').disabled = !end;
            }

            log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const entry = {
                    time: timestamp,
                    message: message,
                    type: type
                };
                
                this.eventLog.push(entry);
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–æ–≥–æ–≤
                if (this.eventLog.length > 100) {
                    this.eventLog = this.eventLog.slice(-50);
                }
                
                this.updateLogDisplay();
                console.log(`[${timestamp}] ${message}`);
            }

            updateLogDisplay() {
                const logEl = document.getElementById('eventLog');
                logEl.innerHTML = this.eventLog.map(entry => 
                    `<div class="log-entry ${entry.type}">[${entry.time}] ${entry.message}</div>`
                ).join('');
                
                // –ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –≤–Ω–∏–∑
                logEl.scrollTop = logEl.scrollHeight;
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function testVKBridge() {
            if (window.vkMultiplayer && window.vkMultiplayer.bridge) {
                window.vkMultiplayer.bridge.send('VKWebAppGetUserInfo').then(result => {
                    console.log('VK Bridge —Ç–µ—Å—Ç:', result);
                    demo.log('üß™ VK Bridge —Ç–µ—Å—Ç —É—Å–ø–µ—à–µ–Ω', 'success');
                }).catch(error => {
                    console.error('VK Bridge –æ—à–∏–±–∫–∞:', error);
                    demo.log('‚ùå VK Bridge —Ç–µ—Å—Ç –Ω–µ—É–¥–∞—á–µ–Ω', 'error');
                });
            }
        }

        function testStorage() {
            if (window.vkMultiplayer && window.vkMultiplayer.bridge) {
                window.vkMultiplayer.bridge.send('VKWebAppStorageGet', {
                    keys: ['player_stats']
                }).then(result => {
                    console.log('–•—Ä–∞–Ω–∏–ª–∏—â–µ —Ç–µ—Å—Ç:', result);
                    demo.log('üß™ –•—Ä–∞–Ω–∏–ª–∏—â–µ —Ç–µ—Å—Ç —É—Å–ø–µ—à–µ–Ω', 'success');
                }).catch(error => {
                    console.error('–•—Ä–∞–Ω–∏–ª–∏—â–µ –æ—à–∏–±–∫–∞:', error);
                    demo.log('‚ùå –•—Ä–∞–Ω–∏–ª–∏—â–µ —Ç–µ—Å—Ç –Ω–µ—É–¥–∞—á–µ–Ω', 'error');
                });
            }
        }

        function simulateMove() {
            if (demo.gameActive) {
                demo.sendTestMove();
            } else {
                demo.log('‚ö†Ô∏è –ò–≥—Ä–∞ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞', 'warning');
            }
        }

        function clearLogs() {
            demo.eventLog = [];
            demo.updateLogDisplay();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ–º–æ
        let demo;
        document.addEventListener('DOMContentLoaded', () => {
            demo = new VKMultiplayerDemo();
        });
    </script>
</body>
</html> 