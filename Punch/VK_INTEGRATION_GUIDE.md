# üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞ —Å VK Bridge

## üìã –û–±–∑–æ—Ä

–ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É VK Bridge** –¥–ª—è:
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –í–ö–æ–Ω—Ç–∞–∫—Ç–µ
- ‚úÖ –•—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä—ã
- ‚úÖ –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –¥—Ä—É–∑–µ–π
- ‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ VK Bridge

–î–æ–±–∞–≤—å—Ç–µ –≤ `index.html` –ø–µ—Ä–µ–¥ –¥—Ä—É–≥–∏–º–∏ —Å–∫—Ä–∏–ø—Ç–∞–º–∏:

```html
<!-- VK Bridge -->
<script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>

<!-- –ù–∞—à –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä -->
<script src="scripts/vk-multiplayer.js"></script>
```

### 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

VK –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:

```javascript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è window.vkMultiplayer
// –î–æ—Å—Ç—É–ø–Ω—ã –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è Construct 3
```

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∏–≥—Ä–æ–π

–í Construct 3 –¥–æ–±–∞–≤—å—Ç–µ —Å–æ–±—ã—Ç–∏—è:

```javascript
// –ö–Ω–æ–ø–∫–∞ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞
On touched object: multiplayerButton
-> Browser: Execute JavaScript: "StartMultiplayerMatchmaking()"

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Ö–æ–¥–æ–≤
On collision: theRabbit with target
-> Browser: Execute JavaScript: 
   "SendMultiplayerMove('punch', theRabbit.X, theRabbit.Y, score, combo)"
```

## üéÆ API —Ñ—É–Ω–∫—Ü–∏–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

```javascript
// –ù–∞—á–∞—Ç—å –ø–æ–∏—Å–∫ –∏–≥—Ä—ã
StartMultiplayerMatchmaking()

// –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ö–æ–¥
SendMultiplayerMove(moveType, x, y, score, combo)

// –ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É
EndMultiplayerGame()

// –û—Ç–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫
CancelMultiplayerMatchmaking()

// –ü–æ–ª—É—á–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
GetMultiplayerState()

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
IsMultiplayerActive()
```

### –°–æ–±—ã—Ç–∏—è –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞:

```javascript
// –ü–æ–∫–∞–∑–∞—Ç—å UI –ø–æ–∏—Å–∫–∞
window.OnShowMatchmakingUI = function() {
    // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω "–ü–æ–∏—Å–∫ –∏–≥—Ä—ã..."
};

// –°–∫—Ä—ã—Ç—å UI –ø–æ–∏—Å–∫–∞
window.OnHideMatchmakingUI = function() {
    // –°–∫—Ä—ã—Ç—å —ç–∫—Ä–∞–Ω –ø–æ–∏—Å–∫–∞
};

// –ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å
window.OnMultiplayerGameStart = function(opponentId, gameId) {
    // –ü–æ–∫–∞–∑–∞—Ç—å –∏–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω
    // opponentId - ID –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
    // gameId - ID –∏–≥—Ä—ã
};

// –•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
window.OnOpponentMove = function(moveType, x, y, score, combo) {
    // –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ö–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
};

// –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
window.OnMultiplayerGameEnd = function(result, myScore, opponentScore) {
    // result: 'win', 'lose', 'draw'
    // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
};
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ VK –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 1. –°–æ–∑–¥–∞–Ω–∏–µ VK Mini App

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **VK –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤**: https://vk.com/dev
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ **Mini App**
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   - **–ù–∞–∑–≤–∞–Ω–∏–µ**: "–ö—Ä–æ–ª–∏–∫ –ü–∞–Ω—á"
   - **–¢–∏–ø**: HTML5 –∏–≥—Ä–∞
   - **URL**: –∞–¥—Ä–µ—Å –≤–∞—à–µ–π –∏–≥—Ä—ã

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```javascript
// –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –¥–æ–º–µ–Ω—ã
Trusted domains: your-game-domain.com

// –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã VK Bridge
VKWebAppInit
VKWebAppGetUserInfo
VKWebAppStorageGet
VKWebAppStorageSet
VKWebAppShowWallPostBox
VKWebAppGetFriends
```

### 3. –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

–ó–∞–ø—Ä–æ—Å–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è:
- **–ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** - –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–º–µ–Ω–∏ –∏ —Ñ–æ—Ç–æ
- **–î—Ä—É–∑—å—è** - –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
- **–ü—É–±–ª–∏–∫–∞—Ü–∏–∏** - –¥–ª—è –ø–æ—Å—Ç–æ–≤ –æ –ø–æ–±–µ–¥–∞—Ö

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### VK Storage –∫–ª—é—á–∏:

```javascript
// –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–≥—Ä
"multiplayer_games": [
    {
        "id": "game_1234567890_12345",
        "host": 12345,
        "hostName": "–ò–≥—Ä–æ–∫1",
        "status": "waiting",
        "createdAt": 1234567890
    }
]

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–∞
"player_stats": {
    "gamesPlayed": 25,
    "wins": 15,
    "losses": 10,
    "rating": 1250
}

// –î–∞–Ω–Ω—ã–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∏–≥—Ä—ã
"game_[gameId]": {
    "id": "game_1234567890_12345",
    "status": "playing",
    "players": {
        "12345": {
            "id": 12345,
            "name": "–ò–≥—Ä–æ–∫1",
            "photo": "https://...",
            "score": 150,
            "ready": true
        }
    },
    "moves": [
        {
            "playerId": 12345,
            "type": "punch",
            "x": 50,
            "y": 60,
            "score": 30,
            "timestamp": 1234567891
        }
    ],
    "createdAt": 1234567890,
    "endTime": null
}
```

## üéØ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Construct 3

### Event Sheet: menuEvent

```javascript
// –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞
On start of layout
-> System: Create object multiplayerButton on layer "UI"

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è
On touched object: multiplayerButton
-> Browser: Execute JavaScript: "StartMultiplayerMatchmaking()"
```

### Event Sheet: gameEvent

```javascript
// –û—Ç–ø—Ä–∞–≤–∫–∞ —Ö–æ–¥–æ–≤
On collision: theRabbit with redbox
-> Browser: Execute JavaScript: 
   "SendMultiplayerMove('punch', theRabbit.X, theRabbit.Y, score, combo)"

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞
System: Every 1 second
-> Browser: Execute JavaScript: 
   "if (IsMultiplayerActive()) { /* –æ–±–Ω–æ–≤–∏—Ç—å UI */ }"
```

### –°–æ–∑–¥–∞–Ω–∏–µ UI —ç–ª–µ–º–µ–Ω—Ç–æ–≤

–î–æ–±–∞–≤—å—Ç–µ –≤ Construct 3:

```javascript
// –û–±—ä–µ–∫—Ç—ã –¥–ª—è –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞
multiplayerButton - –∫–Ω–æ–ø–∫–∞ "–ò–≥—Ä–∞—Ç—å —Å –¥—Ä—É–≥–æ–º"
matchmakingUI - —ç–∫—Ä–∞–Ω –ø–æ–∏—Å–∫–∞ –∏–≥—Ä—ã
opponentInfo - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–µ
gameResults - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–≥—Ä—ã
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–û—Ç–∫—Ä–æ–π—Ç–µ `vk-multiplayer-demo.html` –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- –≠–º—É–ª—è—Ü–∏—è VK Bridge
- –ü–æ–ª–Ω—ã–π workflow –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞
- –õ–æ–≥–∏ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ VK

1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–≥—Ä—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä
2. –°–æ–∑–¥–∞–π—Ç–µ VK Mini App
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —á–µ—Ä–µ–∑ VK

### 3. –û—Ç–ª–∞–¥–∫–∞

```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ VK Bridge
console.log('VK Bridge:', window.vkBridge);

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞
console.log('–ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä:', window.vkMultiplayer);

// –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
console.log('–°–æ—Å—Ç–æ—è–Ω–∏–µ:', GetMultiplayerState());
```

## üîç –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: VK Bridge –Ω–µ –Ω–∞–π–¥–µ–Ω
```javascript
// –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
if (typeof vkBridge === 'undefined') {
    console.error('VK Bridge –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω');
}
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
```javascript
// –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ VK –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
// –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–º–µ–Ω –≤ —Å–ø–∏—Å–∫–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ
```javascript
// –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ Storage
vkBridge.send('VKWebAppStorageGet', {keys: ['test']})
    .then(result => console.log('Storage —Ä–∞–±–æ—Ç–∞–µ—Ç'))
    .catch(error => console.error('Storage –æ—à–∏–±–∫–∞:', error));
```

## üéâ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ VK Bridge

‚úÖ **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞** - —Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –≤ VK  
‚úÖ **–ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –º–∏–Ω–∏–º—É–º –∫–æ–¥–∞  
‚úÖ **–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** - –¥—Ä—É–∑—å—è, –ø–æ—Å—Ç—ã, –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è  
‚úÖ **–ù–∞–¥–µ–∂–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** - –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ VK  
‚úÖ **–ë—ã—Å—Ç—Ä–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–æ—Ä–º  

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- **VK –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤**: https://vk.com/dev
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è VK Bridge**: https://vk.com/dev/bridge
- **–î–µ–º–æ-—Å—Ç—Ä–∞–Ω–∏—Ü–∞**: `vk-multiplayer-demo.html`

---

**üéØ –ì–æ—Ç–æ–≤–æ! –ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å VK Bridge!** 