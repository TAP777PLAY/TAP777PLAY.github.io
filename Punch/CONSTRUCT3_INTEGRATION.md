# üéÆ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è VK –ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞ —Å Construct 3

## üìã –û–±–∑–æ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ—á–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é VK –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞ –≤ –∏–≥—Ä—É "–ö—Ä–æ–ª–∏–∫ –ü–∞–Ω—á" —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è Construct 3.

## üéØ –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ Event Sheets

### 1. Event Sheet: `menuEvent` (–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é)

#### –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞:

```javascript
// –°–æ–±—ã—Ç–∏–µ: On start of layout
// –î–µ–π—Å—Ç–≤–∏–µ: System -> Create object
// –û–±—ä–µ–∫—Ç: buttons (–∫–Ω–æ–ø–∫–∞)
// Layer: Layer 0
// X: 80, Y: 120
// –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é –Ω–∞ frame 2 (–µ—Å–ª–∏ –µ—Å—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞)
```

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞:

```javascript
// –°–æ–±—ã—Ç–∏–µ: Touch -> On touched object: buttons
// –£—Å–ª–æ–≤–∏–µ: buttons -> Compare frame = 2 (–µ—Å–ª–∏ —ç—Ç–æ –∫–Ω–æ–ø–∫–∞ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞)
// –î–µ–π—Å—Ç–≤–∏—è:
// 1. Audio -> Play (by name): "pop" (–∑–≤—É–∫ –Ω–∞–∂–∞—Ç–∏—è)
// 2. Browser -> Execute JavaScript: "StartMultiplayerMatchmaking()"
```

### 2. Event Sheet: `gameEvent` (–û—Å–Ω–æ–≤–Ω–∞—è –∏–≥—Ä–∞)

#### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏–≥—Ä—ã:

```javascript
// –°–æ–±—ã—Ç–∏–µ: System -> On start of layout
// –î–µ–π—Å—Ç–≤–∏–µ: Browser -> Execute JavaScript: 
"
// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä
if (IsMultiplayerActive()) {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞
    console.log('–ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω');
}
"
```

#### –û—Ç–ø—Ä–∞–≤–∫–∞ —Ö–æ–¥–æ–≤ –ø—Ä–∏ —É–¥–∞—Ä–µ –∫—Ä–æ–ª–∏–∫–∞:

–ù–∞–π–¥–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è —É–¥–∞—Ä–æ–≤ (–∫–æ–≥–¥–∞ –∫—Ä–æ–ª–∏–∫ –ø–æ–ø–∞–¥–∞–µ—Ç –ø–æ —Ü–µ–ª–∏) –∏ –¥–æ–±–∞–≤—å—Ç–µ:

```javascript
// –í —Å–æ–±—ã—Ç–∏–µ: theRabbit -> On collision with redbox/bluebox
// –ü–æ—Å–ª–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π –¥–æ–±–∞–≤–∏—Ç—å:
// Browser -> Execute JavaScript:
"
if (IsMultiplayerActive()) {
    SendMultiplayerMove('punch', theRabbit.X, theRabbit.Y, score, combo);
    UpdateMyMultiplayerScore(score);
}
"
```

#### –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–±–æ —É–¥–∞—Ä–æ–≤:

```javascript
// –í —Å–æ–±—ã—Ç–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–±–æ (–∫–æ–≥–¥–∞ combo > 1)
// Browser -> Execute JavaScript:
"
if (IsMultiplayerActive()) {
    SendMultiplayerMove('combo', theRabbit.X, theRabbit.Y, score, combo);
    UpdateMyMultiplayerScore(score);
}
"
```

#### –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã –≤ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–µ:

```javascript
// –í —Å–æ–±—ã—Ç–∏–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∏–ª–∏ –∏–≥—Ä—ã
// –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª–æ–≤–∏–µ: Browser -> Execute JavaScript (expression): "IsMultiplayerActive()"
// –î–µ–π—Å—Ç–≤–∏–µ: Browser -> Execute JavaScript: "EndMultiplayerGame()"
```

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞ –≤ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–µ:

```javascript
// –í –ª—é–±–æ–µ —Å–æ–±—ã—Ç–∏–µ, –≥–¥–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è score
// –î–æ–±–∞–≤–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ: Browser -> Execute JavaScript:
"
if (IsMultiplayerActive()) {
    UpdateMyMultiplayerScore(score);
}
"
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞

–°–æ–∑–¥–∞–π—Ç–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

- `isMultiplayer` (Boolean) - –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä
- `opponentScore` (Number) - —Å—á–µ—Ç –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
- `multiplayerGameId` (Text) - ID —Ç–µ–∫—É—â–µ–π –∏–≥—Ä—ã

### 4. –°–æ–∑–¥–∞–Ω–∏–µ UI —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞

#### –ö–Ω–æ–ø–∫–∞ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞ –≤ –º–µ–Ω—é:

1. –û—Ç–∫—Ä–æ–π—Ç–µ layout `menu`
2. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç `Sprite` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `buttons`
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π frame —Å —Ç–µ–∫—Å—Ç–æ–º "–ò–≥—Ä–∞—Ç—å —Å –¥—Ä—É–≥–æ–º" –∏–ª–∏ —Å–∏–º–≤–æ–ª–æ–º üéÆ
4. –†–∞–∑–º–µ—Å—Ç–∏—Ç–µ –∫–Ω–æ–ø–∫—É —Ä—è–¥–æ–º —Å –¥—Ä—É–≥–∏–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏ –º–µ–Ω—é

#### –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞ –≤ –∏–≥—Ä–µ:

1. –û—Ç–∫—Ä–æ–π—Ç–µ layout `game`
2. –ù–∞ —Å–ª–æ–µ `UI` –¥–æ–±–∞–≤—å—Ç–µ `Spritefont2` –æ–±—ä–µ–∫—Ç—ã:
   - `multiplayerStatus` - —Å—Ç–∞—Ç—É—Å –∏–≥—Ä—ã ("–ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä", "–û–∂–∏–¥–∞–Ω–∏–µ —Ö–æ–¥–∞")
   - `opponentScoreText` - "–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫: 0"

### 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞

–î–æ–±–∞–≤—å—Ç–µ –≤ `gameEvent`:

```javascript
// –°–æ–±—ã—Ç–∏–µ: System -> Every 1 second
// –£—Å–ª–æ–≤–∏–µ: Browser -> Execute JavaScript (expression): "IsMultiplayerActive()"
// –î–µ–π—Å—Ç–≤–∏–µ: Browser -> Execute JavaScript:
"
// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
const state = GetMultiplayerState();
if (state.isActive) {
    // –û–±–Ω–æ–≤–ª—è–µ–º UI
    if (state.opponentScore !== undefined) {
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—á–µ—Ç–∞ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
        console.log('–°—á–µ—Ç –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞:', state.opponentScore);
    }
}
"
```

### 6. –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞

#### –ü–æ–∫–∞–∑ —Ö–æ–¥–∞ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞:

```javascript
// –í –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é OnOpponentMove –¥–æ–±–∞–≤–∏—Ç—å:
// (—ç—Ç–æ —É–∂–µ –µ—Å—Ç—å –≤ index.html, –Ω–æ –º–æ–∂–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç—å —á–µ—Ä–µ–∑ Construct 3)

// –°–æ–±—ã—Ç–∏–µ: Browser -> On script finished: "onOpponentMove"
// –î–µ–π—Å—Ç–≤–∏—è:
// 1. –°–æ–∑–¥–∞—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –≤ –ø–æ–∑–∏—Ü–∏–∏ —Ö–æ–¥–∞ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
// 2. –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∑–≤—É–∫ —É–¥–∞—Ä–∞
// 3. –ü–æ–∫–∞–∑–∞—Ç—å "+X –æ—á–∫–æ–≤" –¥–ª—è –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –î–æ—Å—Ç—É–ø–Ω—ã–µ JavaScript —Ñ—É–Ω–∫—Ü–∏–∏:

- `StartMultiplayerMatchmaking()` - –Ω–∞—á–∞—Ç—å –ø–æ–∏—Å–∫ –∏–≥—Ä—ã
- `SendMultiplayerMove(type, x, y, score, combo)` - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ö–æ–¥
- `EndMultiplayerGame()` - –∑–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É
- `IsMultiplayerActive()` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞
- `GetMultiplayerState()` - –ø–æ–ª—É—á–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
- `UpdateMyMultiplayerScore(score)` - –æ–±–Ω–æ–≤–∏—Ç—å —Å–≤–æ–π —Å—á–µ—Ç

### –°–æ–±—ã—Ç–∏—è –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞:

- `OnShowMatchmakingUI()` - –ø–æ–∫–∞–∑ –ø–æ–∏—Å–∫–∞ –∏–≥—Ä—ã
- `OnHideMatchmakingUI()` - —Å–∫—Ä—ã—Ç–∏–µ –ø–æ–∏—Å–∫–∞ –∏–≥—Ä—ã
- `OnMultiplayerGameStart(opponentId, gameId)` - –Ω–∞—á–∞–ª–æ –∏–≥—Ä—ã
- `OnOpponentMove(type, x, y, score, combo)` - —Ö–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
- `OnMultiplayerGameEnd(result, myScore, opponentScore)` - –æ–∫–æ–Ω—á–∞–Ω–∏–µ –∏–≥—Ä—ã

## üé® –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è UI

### 1. –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞:

- –î–æ–±–∞–≤–∏—Ç—å –º–∏–≥–∞—é—â–∏–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–í —Å–µ—Ç–∏" 
- –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ (–≤—Ä–∞—â–∞—é—â–∏–π—Å—è —Å–ø–∏–Ω–Ω–µ—Ä)
- –≠—Ñ—Ñ–µ–∫—Ç –ø–æ—è–≤–ª–µ–Ω–∏—è —Ö–æ–¥–æ–≤ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞

### 2. –ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã:

- –ó–≤—É–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–≥—Ä–µ
- –ó–≤—É–∫ —Ö–æ–¥–∞ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ (–æ—Ç–ª–∏—á–Ω—ã–π –æ—Ç —Å–≤–æ–µ–≥–æ)
- –ó–≤—É–∫ –ø–æ–±–µ–¥—ã/–ø–æ—Ä–∞–∂–µ–Ω–∏—è –≤ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–µ

### 3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:

- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)
- –°—á–µ—Ç—á–∏–∫ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ö–æ–¥–∞
- –ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ö–æ–¥–æ–≤

## üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

1. –û—Ç–∫—Ä–æ–π—Ç–µ `vk-multiplayer-demo.html` –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ VK:

1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–≥—Ä—É –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥
2. –°–æ–∑–¥–∞–π—Ç–µ VK Mini App
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ–º–µ–Ω—ã –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ VK

## üìù –ß–µ–∫–ª–∏—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞ –≤ –º–µ–Ω—é
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã —Å–æ–±—ã—Ç–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ö–æ–¥–æ–≤
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä –∏–≥—Ä—ã
- [ ] –°–æ–∑–¥–∞–Ω UI –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–µ
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ª–æ–∫–∞–ª—å–Ω–æ
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ VK Mini App
- [ ] –ü—Ä–æ–≤–µ–¥–µ–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

## üîó –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [VK Bridge –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://dev.vk.com/bridge/overview)
- [VK Mini Apps](https://dev.vk.com/mini-apps/overview)
- [Construct 3 JavaScript](https://www.construct.net/en/make-games/manuals/construct-3/scripting/scripting-reference) 